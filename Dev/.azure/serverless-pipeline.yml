trigger:
  batch: true

pool:
  vmImage: 'windows-2022'

stages:
- stage: Compile
  jobs:
  
  - job: build
    displayName: 'Compile'
  
    steps:
    - task: PowerShell@2
      inputs:
        filePath: '$(Agent.BuildDirectory)/s/Compile.ps1'
        arguments: '-AcceptanceTesting -MSBuildPath "C:\Program Files\Microsoft Visual Studio\2022\Enterprise\MSBuild\Current\Bin\MSBuild.exe"'
        displayName: 'Compile'
  
    - task: DeleteFiles@1
      inputs:
        SourceFolder: '$(Agent.BuildDirectory)\\s\\bin\\AcceptanceTesting'
        Contents: 'TestResults'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\AcceptanceTesting'
        ArtifactName: 'TestBinaries'
        publishLocation: 'Container'
        StoreAsTar: false
        
- stage: Test
  jobs:
  
  - job: SQL_Bulk_Insert_Tool_Specs
    displayName: 'SQL Bulk Insert Tool Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Warewolf.Tools.Specs -Category SqlBulkInsert'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'SQL Bulk Insert Tool Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: Workflow_Execution_Specs
    displayName: 'Workflow Execution Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Activities.Specs -Category WorkflowExecution'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Workflow Execution Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: Studio_Test_Framework_With_Hello_World_Workflow_Specs
    displayName: 'Studio Test Framework With Hello World Workflow Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Activities.Specs -Category StudioTestFrameworkWithHelloWorldWorkflow -PreTestRunScript "Resources - ServerTests\Deploy.bat"'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Test Framework With Hello World Workflow Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: Studio_Test_Framework_With_Utility_Tools_Specs
    displayName: 'Studio Test Framework With Utility Tools Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Activities.Specs -Category StudioTestFrameworkWithUtilityTools'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Test Framework With Utility Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: MS_SQL_Server_Specs
    displayName: 'MS SQL Server Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Activities.Specs -Category MSSql'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'MS SQL Server Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: Studio_Test_Framework_With_Data_Tools_Specs
    displayName: 'Studio Test Framework With Data Tools Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Activities.Specs -Category StudioTestFrameworkWithDataTools'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Test Framework With Data Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: Assign_Workflow_Execution_Specs
    displayName: 'Assign Workflow Execution Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Activities.Specs -Category AssignWorkflowExecution'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Assign Workflow Execution Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: Integration_Tests
    displayName: 'Integration Tests'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Integration.Tests -ExcludeCategories "Load Tests","Server Startup",AnonymousRedis'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Integration Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: Studio_Test_Framework_With_Scripting_Tools_Specs
    displayName: 'Studio Test Framework With Scripting Tools Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Activities.Specs -Category StudioTestFrameworkWithScriptingTools'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Test Framework With Scripting Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: Other_Activities_Specs
    displayName: 'Other Activities Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Activities.Specs -ExcludeCategories ExampleWorkflowExecution,DateTimeExampleWorkflowExecution,RemoteServer,StudioTestFrameworkWithScriptingTools,StudioTestFrameworkWithHelloWorldWorkflow,StudioTestFrameworkWithHTTPWebPostTools,StudioTestFrameworkWithHTTPWebGetTools,StudioTestFrameworkWithHTTPWebDeleteTools,MSSql,DatabaseWorkflowExecution,ExecuteInBrowser,StudioTestFrameworkWithUtilityTools,StudioTestFrameworkWithSharepointTools,SubworkflowOracleExecution,RabbitMQWorkflowExecution,WorkflowMerging,StudioTestFrameworkWithFileAndFolderTools,DatabaseSubworkflowExecution,StudioTestFrameworkWithDatabaseTools,StudioTestFrameworkWithSubworkflow,Scheduler,StudioTestFrameworkWithHTTPWebPutTools,StudioTestFrameworkWithDropboxTools,SubworkflowExecution,StudioTestFrameworkWithDataTools,StudioTestFrameworkWithDeletedResources,StudioTestFrameworkWithRabbitMQTools,WorkflowExecution,StudioTestFramework,NestedForEachExecution,WarewolfSearch,AssignWorkflowExecution,WorkflowExecutionLogging,StudioTestFrameworkWithHTTPWebTools,CompositionLoadTests'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Other Activities Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: Studio_Test_Framework_With_File_And_Folder_Tools_Specs
    displayName: 'Studio Test Framework With File And Folder Tools Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Activities.Specs -Category StudioTestFrameworkWithFileAndFolderTools'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Test Framework With File And Folder Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: Studio_Test_Framework_With_HTTP_Web_Tools_Specs
    displayName: 'Studio Test Framework With HTTP Web Tools Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Activities.Specs -Category StudioTestFrameworkWithHTTPWebTools'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Test Framework With HTTP Web Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: Studio_Test_Framework_With_Subworkflow_Specs
    displayName: 'Studio Test Framework With Subworkflow Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Activities.Specs -Category StudioTestFrameworkWithSubworkflow'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Test Framework With Subworkflow Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: Workflow_Merging_Specs
    displayName: 'Workflow Merging Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Activities.Specs -Category WorkflowMerging'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Workflow Merging Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: Example_Workflow_Execution_Specs
    displayName: 'Example Workflow Execution Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Activities.Specs -Categories ExampleWorkflowExecution,DateTimeExampleWorkflowExecution -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath Release" -PostTestRunScript ReverseDeployLog.ps1 -UseRegionalSettings'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Example Workflow Execution Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: Studio_Test_Framework_Specs
    displayName: 'Studio Test Framework Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Activities.Specs -Category StudioTestFramework'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Test Framework Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: Subworkflow_Execution_Specs
    displayName: 'Subworkflow Execution Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Activities.Specs -Category SubworkflowExecution'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Subworkflow Execution Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: Other_Specs
    displayName: 'Other Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.*.Specs,Warewolf.*.Specs -ExcludeProjects Dev2.Activities.Specs,Warewolf.Tools.Specs,Warewolf.UI.Specs,Warewolf.UI.Load.Specs -ExcludeCategories NoConflictingPermissionsSecurity,ResourcePermissionsSecurity,ConflictingViewExecutePermissionsSecurity,ConflictingExecutePermissionsSecurity,ConflictingViewPermissionsSecurity,OverlappingUserGroupsPermissionsSecurity,ServerPermissionsSecurity,ConflictingContributeViewExecutePermissionsSecurity'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Other Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: Studio_Test_Framework_With_Deleted_Resources_Specs
    displayName: 'Studio Test Framework With Deleted Resources Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Activities.Specs -Category StudioTestFrameworkWithDeletedResources'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Test Framework With Deleted Resources Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: SQL_Integration_Tests
    displayName: 'SQL Integration Tests'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Integration.Tests,Warewolf.Tools.Specs -Category SqlDatabaseBroker'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'SQL Integration Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: For_Each_Workflow_Execution_Specs
    displayName: 'For Each Workflow Execution Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Activities.Specs -Category NestedForEachExecution'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'For Each Workflow Execution Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'

  - job: Search_Specs
    displayName: 'Search Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Activities.Specs -Category WarewolfSearch'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Search Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: Database_Workflow_Execution_Specs
    displayName: 'Database Workflow Execution Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Activities.Specs -Category DatabaseWorkflowExecution'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Database Workflow Execution Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: RabbitMQ_Workflow_Execution_Specs
    displayName: 'RabbitMQ Workflow Execution Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Activities.Specs -Category RabbitMQWorkflowExecution'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'RabbitMQ Workflow Execution Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: Studio_Test_Framework_With_HTTP_Web_Get_Tools_Specs
    displayName: 'Studio Test Framework With HTTP Web Get Tools Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Activities.Specs -Category StudioTestFrameworkWithHTTPWebGetTools'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Test Framework With HTTP Web Get Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: Studio_Test_Framework_With_HTTP_Web_Delete_Tools_Specs
    displayName: 'Studio Test Framework With HTTP Web Delete Tools Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Activities.Specs -Category StudioTestFrameworkWithHTTPWebDeleteTools'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Test Framework With HTTP Web Delete Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: Studio_Test_Framework_With_HTTP_Web_Post_Tools_Specs
    displayName: 'Studio Test Framework With HTTP Web Post Tools Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Activities.Specs -Category StudioTestFrameworkWithHTTPWebPostTools'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Test Framework With HTTP Web Post Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: Studio_Test_Framework_With_HTTP_Web_Put_Tools_Specs
    displayName: 'Studio Test Framework With HTTP Web Put Tools Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Activities.Specs -Category StudioTestFrameworkWithHTTPWebPutTools'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Test Framework With HTTP Web Put Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: Studio_Test_Framework_With_RabbitMQ_Tools_Specs
    displayName: 'Studio Test Framework With RabbitMQ Tools Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Activities.Specs -Category StudioTestFrameworkWithRabbitMQTools'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Test Framework With RabbitMQ Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: Database_Subworkflow_Execution_Specs
    displayName: 'Database Subworkflow Execution Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Activities.Specs -Category DatabaseSubworkflowExecution'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Database Subworkflow Execution Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
  
  - job: Workflow_Execution_Logging_Specs
    displayName: 'Workflow Execution Logging Specs'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Activities.Specs -Category WorkflowExecutionLogging'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Workflow Execution Logging Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'
        
    - powershell: 'sc.exe stop "Warewolf Server";exit 0'
      condition: always()
      failOnStderr: false
  
  - job: Server_Startup_Tests
    displayName: 'Server Startup Tests'
  
    steps:
    - checkout: none
    
    - task: DownloadPipelineArtifact@2
      inputs:
        buildType: 'current'
        artifactName: 'TestBinaries'
        targetPath: '$(Agent.BuildDirectory)'
  
    - task: PowerShell@2
      inputs:
        targetType: 'inline'
        script: |
          $username = $env:UseThisServerlessUsername
          $password = $env:UseThisServerlessPassword
          $address = $env:UseThisServerlessAddress
          NET user "$username" "$password" /ADD /Y
          Add-LocalGroupMember -Group Administrators -Member $username 
          $securePassword = ConvertTo-SecureString $password -AsPlainText -Force
          $credential = New-Object System.Management.Automation.PSCredential $username, $securePassword
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=127.0.0.1 connectport=3142 connectaddress=$address
          netsh interface portproxy add v4tov4 listenport=3142 listenaddress=$env:ComputerName connectport=3142 connectaddress=$address
          @"
          Start-Process -Wait -Verb RunAs -File powershell -ArgumentList '-NoProfile -NoLogo -ExecutionPolicy Bypass -File "$(Agent.BuildDirectory)\Job Shortcuts\TestRun.ps1" -RunInDirectory "$(Agent.BuildDirectory)" -Projects Dev2.Integration.Tests -Category "Server Startup"'
          "@ | Out-File -LiteralPath "C:\RunTestsAsAdministrator.ps1" -Encoding utf8 -Force
          Start-Process -Wait -Credential $credential -FilePath powershell -ArgumentList "-NoProfile -NoLogo -ExecutionPolicy Bypass -File C:\RunTestsAsAdministrator.ps1"
        displayName: 'Run Tests'
      env:
        UseThisServerlessUsername: $(ServerlessUsername)
        UseThisServerlessPassword: $(ServerlessPassword)
        UseThisServerlessAddress: $(ServerlessAddress)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Server Startup Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" exit 1'