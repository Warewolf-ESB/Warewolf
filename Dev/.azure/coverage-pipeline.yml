schedules:
- cron: "0 0 * * *"
  displayName: Daily midnight build
  branches:
    include:
    - "*"

pool:
  name: Default

stages:
- stage: Compile
  jobs:
  
  - job: build
    displayName: 'Compile'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
      persistCredentials: true
      
    - script: |
        mkdir D:\Builds
        IF NOT EXIST "D:\Builds\SonarQube" git -C "D:\Builds" clone "$(Build.Repository.Uri)" SonarQube
        IF EXIST "D:\Builds\SonarQube\.git\index.lock" DEL /F "D:\Builds\SonarQube\.git\index.lock"
        git -C "D:\Builds\SonarQube" reset --hard HEAD
        git -C "D:\Builds\SonarQube" clean -xdf --exclude Dev/packages/
        git -C "D:\Builds\SonarQube" fetch --all
        IF [$(Build.SourceVersion)] NEQ [] (
            echo Checking out version $(Build.SourceVersion)
            git -C "D:\Builds\SonarQube" checkout $(Build.SourceVersion)
        ) ELSE (
            IF [$(Build.SourceBranch)] NEQ [] (
                echo Checking out branch $(Build.SourceBranch)
                git -C "D:\Builds\SonarQube" checkout $(Build.SourceBranch)
            )
            git -C "D:\Builds\SonarQube" pull
        )
      displayName: 'Scorch Sonar Shared Working Directory'
      
    - task: DownloadPipelineArtifact@2
      inputs:
        source: 'specific'
        project: '$(System.TeamProjectId)'
        pipeline: 10
        runVersion: 'latest'
        allowPartiallySucceededBuilds: true
        
    - powershell: |
        New-Item -ItemType Directory "D:\Builds\SonarQube\bin\AcceptanceTesting"
        expand "$(Agent.BuildDirectory)\WebView2\Microsoft.WebView2.FixedVersionRuntime.cab" -F:* "D:\Builds\SonarQube\bin\AcceptanceTesting"
      displayName: 'Expand WebView2 Cab'

    - powershell: 'nuget restore "D:\Builds\SonarQube\Dev\AcceptanceTesting.sln"'
      displayName: 'Restore Nuget Packages'
    
    - task: PowerShell@2
      inputs:
        filePath: 'D:\Builds\SonarQube\Compile.ps1'
        arguments: '-AcceptanceTesting -MSBuildPath "C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise\MSBuild\Current\Bin\MSBuild.exe"'
  
    - task: DeleteFiles@1
      inputs:
        SourceFolder: 'D:\Builds\SonarQube\bin\AcceptanceTesting'
        Contents: 'TestResults'
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %PushVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rmi registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest
        docker cp "D:\Builds\SonarQube\bin\AcceptanceTesting" $(Build.SourceVersion):C:\BuildUnderTest
        docker commit $(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        docker push registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
      displayName: 'Publish Build Image'
      env:
        PushVSTestContainer: $(VSTestContainerPassword)
        
- stage: Test
  jobs:
  
  - job: Unit_Tests
    displayName: 'Unit Tests'
    
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.*.Tests,Warewolf.*.Tests,Warewolf.UIBindingTests.* -ExcludeProjects Dev2.Integration.Tests,Dev2.Studio.Core.Tests,Dev2.RunTime.Tests,Dev2.Infrastructure.Tests,Warewolf.UI.Tests,Warewolf.Logger.Tests,Warewolf.Studio.ViewModels.Tests,Warewolf.Web.UI.Tests,Warewolf.Storage.Tests,Warewolf.Auditing.Tests -ExcludeCategories CannotParallelize,ResourceCatalog_LoadTests,PluginRuntimeHandler,GatherSystemInformation,LocalSchedulerAdmin,Multithread
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Elasticsearch View Model Test Port Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Scheduler_Admin_User_Unit_Tests
    displayName: 'Scheduler Admin User Unit Tests'
    pool:
      vmImage: 'windows-2019'
    
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -CreateLocalSchedulerAdmin -Projects Dev2.Data.Tests,Dev2.TaskScheduler.Wrappers.Tests -Category LocalSchedulerAdmin
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)/s/bin/BuildUnderTest/TestResults/*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Scheduler Admin User Unit Tests'
       
    - script: 'if not exist "$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Scheduler Admin User Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Scheduler Admin User Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Multithread_Unit_Tests
    displayName: 'Multithread Unit Tests'
    pool:
      vmImage: 'windows-2019'
    
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Common.NetStandard20.Tests -Category Multithread
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)/s/bin/BuildUnderTest/TestResults/*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Multithread Unit Tests'
       
    - script: 'if not exist "$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Multithread Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Multithread Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
        
  - job: Zip_Tool_Specs
    displayName: 'Zip Tool Specs'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category Zip>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Zip Tool Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Zip Tool Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Zip Tool Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Email_Tools_Specs
    displayName: 'Email Tools Specs'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category Email>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Email Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Email Tools Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Email Tools Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Resource_Tools_Specs
    displayName: 'Resource Tools Specs'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category Resources>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Resource Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Resource Tools Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Resource Tools Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: File_And_Folder_Copy_Tool_Specs
    displayName: 'File And Folder Copy Tool Specs'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category FileAndFolderCopy>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'File And Folder Copy Tool Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'File And Folder Copy Tool Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'File And Folder Copy Tool Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Data_Tools_Specs
    displayName: 'Data Tools Specs'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category Data>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Data Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Data Tools Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Data Tools Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Request_Service_Name_View_Models_Unit_Tests
    displayName: 'Request Service Name View Models Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Studio.ViewModels.Tests -Category RequestServiceNameViewModel>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Request Service Name View Models Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Request Service Name View Models Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Request Service Name View Models Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Unzip_Tool_Specs_Validation
    displayName: 'Unzip Tool Specs Validation'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category UnzipValidation>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Unzip Tool Specs Validation'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Unzip Tool Specs Validation Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Unzip Tool Specs Validation Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Recordset_Tools_Specs
    displayName: 'Recordset Tools Specs'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category Recordset>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Recordset Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Recordset Tools Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Recordset Tools Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: File_And_Folder_Rename_Tool_Specs
    displayName: 'File And Folder Rename Tool Specs'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category FileAndFolderRename
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'File And Folder Rename Tool Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'File And Folder Rename Tool Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'File And Folder Rename Tool Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
    
  - job: Other_Tools_Specs
    displayName: 'Other Tools Specs'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -ExcludeCategories Recordset,FileMoveFromFTP,ZipFromFTPS,UnzipFromLocal,UnzipFromFTPS,CopyFileFromFTP,SqlBulkInsert,FileAndFolderDelete,CopyFileFromSFTP,FileMoveFromFTPS,WriteFile,FileRenameFromLocal,Storage,FileRenameFromFTPS,ReadFolder,FileAndFolderCreate,ControlFlow,FileRenameFromFTP,FileMoveFromUNC,CopyFileFromFTPS,Scripting,Zip,ZipFromLocal,CopyFileFromUNC,FileAndFolderRename,UnzipFromFTP,FileAndFolderMove,FileMoveFromLocal,Resources,CopyFileFromLocal,DatabaseTimeout,Database,UnzipValidation,Email,ZipFromSFTP,FileRenameFromUNC,UnzipFromSFTP,FileAndFolderCopy,LoopConstructs,ZipFromFTP,NewReadFolder,FileMoveFromSFTP,Data,ReadFile,FileRenameFromSFTP,Utility>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Other Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Other Tools Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Other Tools Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: File_And_Folder_Move_Tool_Specs
    displayName: 'File And Folder Move Tool Specs'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category FileAndFolderMove>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'File And Folder Move Tool Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'File And Folder Move Tool Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'File And Folder Move Tool Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: File_Read_Tool_Specs
    displayName: 'File Read Tool Specs'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category ReadFile
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'File Read Tool Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'File Read Tool Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'File Read Tool Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Infrastructure_Unit_Tests
    displayName: 'Infrastructure Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Infrastructure.Tests>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Infrastructure Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Infrastructure Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Infrastructure Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: New_Folder_Read_Tool_Specs
    displayName: 'New Folder Read Tool Specs'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category NewReadFolder>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'New Folder Read Tool Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'New Folder Read Tool Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'New Folder Read Tool Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Write_File_Tool_Specs
    displayName: 'Write File Tool Specs'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %PushVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        PushVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category WriteFile
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Write File Tool Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Write File Tool Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Write File Tool Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Loop_Construct_Tools_Specs
    displayName: 'Loop Construct Tools Specs'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category LoopConstructs>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Loop Construct Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Loop Construct Tools Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Loop Construct Tools Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Utility_Tools_Specs
    displayName: 'Utility Tools Specs'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category Utility>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Utility Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Utility Tools Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Utility Tools Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Folder_Read_Tool_Specs
    displayName: 'Folder Read Tool Specs'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category ReadFolder>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Folder Read Tool Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Folder Read Tool Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Folder Read Tool Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: SQL_Bulk_Insert_Tool_Specs
    displayName: 'SQL Bulk Insert Tool Specs'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category SqlBulkInsert -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'SQL Bulk Insert Tool Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'SQL Bulk Insert Tool Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'SQL Bulk Insert Tool Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Control_Flow_Tools_Specs
    displayName: 'Control Flow Tools Specs'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category ControlFlow>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Control Flow Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Control Flow Tools Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Control Flow Tools Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Studio_View_Models_Unit_Tests
    displayName: 'Studio View Models Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Studio.ViewModels.Tests -ExcludeCategories ElasticsearchSourceViewModel,RequestServiceNameViewModel,ElasticsearchSourceViewModel_Constructor,ElasticsearchSourceViewModel_TestOkCommand,ElasticsearchSourceViewModel_TestName,ElasticsearchSourceViewModel_RequestServiceNameViewModel,ElasticsearchSourceViewModel_TestResourceName,ElasticsearchSourceViewModel_TestHostName,ElasticsearchSourceViewModel_TestPort,ElasticsearchSourceViewModel_TestUsername,ElasticsearchSourceViewModel_TestPassword,ElasticsearchSourceViewModel_TestAuthenticationType,ElasticsearchSourceViewModel_Test,ElasticsearchSourceViewModel_TestHeaderText,ElasticsearchSourceViewModel_TestModelItem,ElasticsearchSourceViewModel_TestSaveSource,ElasticsearchSourceViewModel_TestSave,ElasticsearchSourceViewModel_TestUpdateHelpDescriptor,ElasticsearchSourceViewModel_TestCanSave,ElasticsearchSourceViewModel_CanTest>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio View Models Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Studio View Models Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Studio View Models Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: File_And_Folder_Create_Tool_Specs
    displayName: 'File And Folder Create Tool Specs'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category FileAndFolderCreate
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'File And Folder Create Tool Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'File And Folder Create Tool Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'File And Folder Create Tool Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Storage_Unit_Tests
    displayName: 'Storage Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Storage.Tests>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Storage Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Storage Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Storage Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Storage_Tools_Specs
    displayName: 'Storage Tools Specs'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category Storage>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Storage Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Storage Tools Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Storage Tools Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: File_And_Folder_Delete_Tool_Specs
    displayName: 'File And Folder Delete Tool Specs'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category FileAndFolderDelete
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'File And Folder Delete Tool Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'File And Folder Delete Tool Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'File And Folder Delete Tool Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Scripting_Tools_Specs
    displayName: 'Scripting Tools Specs'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category Scripting>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Scripting Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Scripting Tools Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Scripting Tools Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Database_Tools_Specs
    displayName: 'Database Tools Specs'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category Database>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Database Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Database Tools Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Database Tools Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Auditing_Unit_Tests
    displayName: 'Auditing Unit Tests'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Auditing.Tests>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Auditing Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Auditing Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Auditing Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Workflow_Execution_Specs
    displayName: 'Workflow Execution Specs'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Activities.Specs -Category WorkflowExecution -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Workflow Execution Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Workflow Execution Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Workflow Execution Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Studio_Test_Framework_With_Hello_World_Workflow_Specs
    displayName: 'Studio Test Framework With Hello World Workflow Specs'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Activities.Specs -Category StudioTestFrameworkWithHelloWorldWorkflow -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Test Framework With Hello World Workflow Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Studio Test Framework With Hello World Workflow Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Studio Test Framework With Hello World Workflow Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Studio_Test_Framework_With_Utility_Tools_Specs
    displayName: 'Studio Test Framework With Utility Tools Specs'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Activities.Specs -Category StudioTestFrameworkWithUtilityTools -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Test Framework With Utility Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Studio Test Framework With Utility Tools Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Studio Test Framework With Utility Tools Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: MS_SQL_Server_Specs
    displayName: 'MS SQL Server Specs'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Activities.Specs -Category MSSql -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'MS SQL Server Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'MS SQL Server Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'MS SQL Server Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Studio_Test_Framework_With_Data_Tools_Specs
    displayName: 'Studio Test Framework With Data Tools Specs'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Activities.Specs -Category StudioTestFrameworkWithDataTools -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Test Framework With Data Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Studio Test Framework With Data Tools Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Studio Test Framework With Data Tools Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Assign_Workflow_Execution_Specs
    displayName: 'Assign Workflow Execution Specs'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Activities.Specs -Category AssignWorkflowExecution -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Assign Workflow Execution Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Assign Workflow Execution Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Assign Workflow Execution Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Integration_Tests
    displayName: 'Integration Tests'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Integration.Tests -ExcludeCategories "Load Tests","Server Startup" -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Integration Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Integration Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Integration Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Studio_Test_Framework_With_Scripting_Tools_Specs
    displayName: 'Studio Test Framework With Scripting Tools Specs'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Activities.Specs -Category StudioTestFrameworkWithScriptingTools -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Test Framework With Scripting Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Test Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Test Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Other_Activities_Specs
    displayName: 'Other Activities Specs'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Activities.Specs -ExcludeCategories ExampleWorkflowExecution,DateTimeExampleWorkflowExecution,RemoteServer,StudioTestFrameworkWithScriptingTools,StudioTestFrameworkWithHelloWorldWorkflow,StudioTestFrameworkWithHTTPWebPostTools,StudioTestFrameworkWithHTTPWebGetTools,StudioTestFrameworkWithHTTPWebDeleteTools,MSSql,DatabaseWorkflowExecution,ExecuteInBrowser,StudioTestFrameworkWithUtilityTools,StudioTestFrameworkWithSharepointTools,SubworkflowOracleExecution,RabbitMQWorkflowExecution,WorkflowMerging,StudioTestFrameworkWithFileAndFolderTools,DatabaseSubworkflowExecution,StudioTestFrameworkWithDatabaseTools,StudioTestFrameworkWithSubworkflow,Scheduler,StudioTestFrameworkWithHTTPWebPutTools,StudioTestFrameworkWithDropboxTools,SubworkflowExecution,StudioTestFrameworkWithDataTools,StudioTestFrameworkWithDeletedResources,StudioTestFrameworkWithRabbitMQTools,WorkflowExecution,StudioTestFramework,NestedForEachExecution,WarewolfSearch,AssignWorkflowExecution,WorkflowExecutionLogging,StudioTestFrameworkWithHTTPWebTools,CompositionLoadTests -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Other Activities Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Other Activities Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Other Activities Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Studio_Test_Framework_With_File_And_Folder_Tools_Specs
    displayName: 'Studio Test Framework With File And Folder Tools Specs'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Activities.Specs -Category StudioTestFrameworkWithFileAndFolderTools -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Test Framework With File And Folder Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Studio Test Framework With File And Folder Tools Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Studio Test Framework With File And Folder Tools Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Studio_Test_Framework_With_HTTP_Web_Tools_Specs
    displayName: 'Studio Test Framework With HTTP Web Tools Specs'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Activities.Specs -Category StudioTestFrameworkWithHTTPWebTools -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Test Framework With HTTP Web Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Studio Test Framework With HTTP Web Tools Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Studio Test Framework With HTTP Web Tools Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Studio_Test_Framework_With_Subworkflow_Specs
    displayName: 'Studio Test Framework With Subworkflow Specs'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Activities.Specs -Category StudioTestFrameworkWithSubworkflow -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Test Framework With Subworkflow Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Studio Test Framework With Subworkflow Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Studio Test Framework With Subworkflow Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Workflow_Merging_Specs
    displayName: 'Workflow Merging Specs'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Activities.Specs -Category WorkflowMerging -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Workflow Merging Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Workflow Merging Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Workflow Merging Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Example_Workflow_Execution_Specs
    displayName: 'Example Workflow Execution Specs'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Activities.Specs -Categories ExampleWorkflowExecution,DateTimeExampleWorkflowExecution -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath Release" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Example Workflow Execution Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Example Workflow Execution Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Example Workflow Execution Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Studio_Test_Framework_Specs
    displayName: 'Studio Test Framework Specs'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Activities.Specs -Category StudioTestFramework -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Test Framework Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Studio Test Framework Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Studio Test Framework Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Subworkflow_Execution_Specs
    displayName: 'Subworkflow Execution Specs'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Activities.Specs -Category SubworkflowExecution -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Subworkflow Execution Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Subworkflow Execution Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Subworkflow Execution Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Other_Specs
    displayName: 'Other Specs'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.*.Specs,Warewolf.*.Specs -ExcludeProjects Dev2.Activities.Specs,Warewolf.Tools.Specs,Warewolf.UI.Specs,Warewolf.UI.Load.Specs -ExcludeCategories NoConflictingPermissionsSecurity,ResourcePermissionsSecurity,ConflictingViewExecutePermissionsSecurity,ConflictingExecutePermissionsSecurity,ConflictingViewPermissionsSecurity,OverlappingUserGroupsPermissionsSecurity,ServerPermissionsSecurity,ConflictingContributeViewExecutePermissionsSecurity -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Other Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Other Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Other Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Studio_Test_Framework_With_Deleted_Resources_Specs
    displayName: 'Studio Test Framework With Deleted Resources Specs'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Activities.Specs -Category StudioTestFrameworkWithDeletedResources -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Test Framework With Deleted Resources Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Studio Test Framework With Deleted Resources Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Studio Test Framework With Deleted Resources Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: SQL_Integration_Tests
    displayName: 'SQL Integration Tests'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Integration.Tests,Warewolf.Tools.Specs -Category SqlDatabaseBroker -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'SQL Integration Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'SQL Integration Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'SQL Integration Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: For_Each_Workflow_Execution_Specs
    displayName: 'For Each Workflow Execution Specs'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Activities.Specs -Category NestedForEachExecution -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'For Each Workflow Execution Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'For Each Workflow Execution Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'For Each Workflow Execution Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Copy_Tool_Specs_From_Local
    displayName: 'Copy Tool Specs From Local'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category CopyFileFromLocal
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Copy Tool Specs From Local'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Copy Tool Specs From Local Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Copy Tool Specs From Local Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Move_Tool_Specs_From_Local
    displayName: 'Move Tool Specs From Local'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category FileMoveFromLocal
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Move Tool Specs From Local'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Move Tool Specs From Local Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Move Tool Specs From Local Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Rename_Tool_Specs_From_Local
    displayName: 'Rename Tool Specs From Local'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category FileRenameFromLocal
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Rename Tool Specs From Local'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Rename Tool Specs From Local Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Rename Tool Specs From Local Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Unzip_Tool_Specs_From_Local
    displayName: 'Unzip Tool Specs From Local'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category UnzipFromLocal
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Unzip Tool Specs From Local'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Unzip Tool Specs From Local Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Unzip Tool Specs From Local Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Zip_Tool_Specs_From_Local
    displayName: 'Zip Tool Specs From Local'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %PushVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        PushVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category ZipFromLocal
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Zip Tool Specs From Local'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Zip Tool Specs From Local Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Zip Tool Specs From Local Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Copy_Tool_Specs_From_FTP
    displayName: 'Copy Tool Specs From FTP'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category CopyFileFromFTP
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'File Read Tool Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Copy Tool Specs From FTP Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Copy Tool Specs From FTP Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Move_Tool_Specs_From_FTP
    displayName: 'Move Tool Specs From FTP'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category FileMoveFromFTP
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Move Tool Specs From FTP'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Move Tool Specs From FTP Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Move Tool Specs From FTP Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Rename_Tool_Specs_From_FTP
    displayName: 'Rename Tool Specs From FTP'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category FileRenameFromFTP
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Rename Tool Specs From FTP'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Rename Tool Specs From FTP Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Rename Tool Specs From FTP Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Unzip_Tool_Specs_From_FTP
    displayName: 'Unzip Tool Specs From FTP'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category UnzipFromFTP
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Unzip Tool Specs From FTP'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Unzip Tool Specs From FTP Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Unzip Tool Specs From FTP Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Zip_Tool_Specs_From_FTP
    displayName: 'Zip Tool Specs From FTP'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category ZipFromFTP
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Zip Tool Specs From FTP'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Zip Tool Specs From FTP Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Zip Tool Specs From FTP Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Copy_Tool_Specs_From_FTPS
    displayName: 'Copy Tool Specs From FTPS'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category CopyFileFromFTPS
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Copy Tool Specs From FTPS'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Copy Tool Specs From FTPS Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Copy Tool Specs From FTPS Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Move_Tool_Specs_From_FTPS
    displayName: 'Move Tool Specs From FTPS'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category FileMoveFromFTPS
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Move Tool Specs From FTPS'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Move Tool Specs From FTPS Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Move Tool Specs From FTPS Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Rename_Tool_Specs_From_FTPS
    displayName: 'Rename Tool Specs From FTPS'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category FileRenameFromFTPS
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Rename Tool Specs From FTPS'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Rename Tool Specs From FTPS Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Rename Tool Specs From FTPS Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Unzip_Tool_Specs_From_FTPS
    displayName: 'Unzip Tool Specs From FTPS'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category UnzipFromFTPS
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Unzip Tool Specs From FTPS'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Unzip Tool Specs From FTPS Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Unzip Tool Specs From FTPS Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Zip_Tool_Specs_From_FTPS
    displayName: 'Zip Tool Specs From FTPS'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category ZipFromFTPS
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Zip Tool Specs From FTPS'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Zip Tool Specs From FTPS Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Zip Tool Specs From FTPS Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Copy_Tool_Specs_From_SFTP
    displayName: 'Copy Tool Specs From SFTP'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category CopyFileFromSFTP
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Copy Tool Specs From SFTP'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Copy Tool Specs From SFTP Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Copy Tool Specs From SFTP Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Move_Tool_Specs_From_SFTP
    displayName: 'Move Tool Specs From SFTP'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category FileMoveFromSFTP
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Move Tool Specs From SFTP'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Move Tool Specs From SFTP Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Move Tool Specs From SFTP Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Rename_Tool_Specs_From_SFTP
    displayName: 'Rename Tool Specs From SFTP'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category FileRenameFromSFTP
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'FRename Tool Specs From SFTP'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Rename Tool Specs From SFTP Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Rename Tool Specs From SFTP Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Unzip_Tool_Specs_From_SFTP
    displayName: 'Unzip Tool Specs From SFTP'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %PushVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        PushVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category UnzipFromSFTP
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Unzip Tool Specs From SFTP'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Unzip Tool Specs From SFTP Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Unzip Tool Specs From SFTP Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Zip_Tool_Specs_From_SFTP
    displayName: 'Zip Tool Specs From SFTP'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category ZipFromSFTP
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Zip Tool Specs From SFTP'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Zip Tool Specs From SFTP Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Zip Tool Specs From SFTP Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Copy_Tool_Specs_From_UNC
    displayName: 'Copy Tool Specs From UNC'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category CopyFileFromUNC
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Copy Tool Specs From UNC'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Copy Tool Specs From UNC Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Copy Tool Specs From UNC Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Move_Tool_Specs_From_UNC
    displayName: 'Move Tool Specs From UNC'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category FileMoveFromUNC
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Move Tool Specs From UNC'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Move Tool Specs From UNC Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Move Tool Specs From UNC Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Studio_Core_Unit_Tests
    displayName: 'Studio Core Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        New-Item -ItemType directory "$env:localappdata\Warewolf\Studio"
        @"
        <?xml version="1.0" encoding="utf-8"?>
        <log4net>
          <appender name="rollingFile" type="log4net.Appender.RollingFileAppender">
            <file type="log4net.Util.PatternString" value="${LOCALAPPDATA}\Warewolf\Studio Logs\Warewolf Studio.log" />
            <appendToFile value="true" />
            <rollingStyle value="Size" />
            <maxSizeRollBackups value="1" />
            <maximumFileSize value="200MB" />
            <!-- An alternate output encoding can be specified -->
            <!-- <encoding value="unicodeFFFE" /> -->
            <layout type="log4net.Layout.PatternLayout">
              <header value="[Header]&#xD;&#xA;" />
              <footer value="[Footer]&#xD;&#xA;" />
              <conversionPattern value="%date %-5level - %message%newline" />
            </layout>
          </appender>
          <appender name="LogFileAppender" type="Log4Net.Async.ParallelForwardingAppender,Log4Net.Async">
            <appender-ref ref="rollingFile" />
            <bufferSize value="200" />
          </appender>
          <appender name="EventLogLogger" type="log4net.Appender.EventLogAppender">
            <threshold value="ERROR" />
            <mapping>
              <level value="ERROR" />
              <eventLogEntryType value="Error" />
            </mapping>
            <mapping>
              <level value="DEBUG" />
              <eventLogEntryType value="Information" />
            </mapping>
            <mapping>
              <level value="INFO" />
              <eventLogEntryType value="Information" />
            </mapping>
            <mapping>
              <level value="WARN" />
              <eventLogEntryType value="Warning" />
            </mapping>
            <logName value="Warewolf" />
            <applicationName value="Warewolf Server" />
            <layout type="log4net.Layout.PatternLayout">
              <conversionPattern value="%date %-5level - %message%newline" />
            </layout>
          </appender>
          <!-- Setup the root category, add the appenders and set the default level -->
          <root>
            <level value="DEBUG" />
            <appender-ref ref="LogFileAppender" />
            <appender-ref ref="EventLogLogger" />
          </root>
        </log4net>
        "@ | Out-File -LiteralPath "$env:localappdata\Warewolf\Studio\Settings.config" -Encoding utf8 -Force
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Studio.Core.Tests -ExcludeCategories "Intellisense Textbox Visual Tree","Studio Settings Core",SettingsViewModel_SaveCommand,SettingsViewModel_IsDirty,LogSettingsViewModel_Constructor,SettingsViewModel_OnDeactivate,SettingsViewModel_ReturnsFalse,SettingsViewModel_DoDeactivate,LogSettingsViewModel_ServerLogLevel,LogSettingsViewModel_UpdateHelp,LogSettingsViewModel_SelectedLoggingType,LogSettingsViewModel_GetLogFileCommand,LogSettingsViewModel_PropertyChangeFired,LogSettingsViewModel_StudioFileLogLevel,LogSettingsViewModel_Construct -UseRegionalSettings
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)/s/Bin/BuildUnderTest/TestResults/*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Core Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Studio Core Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Studio Core Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Settings_View_Model_Unit_Tests
    displayName: 'Settings View Model Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Studio.Core.Tests -Category "Studio Settings Core">>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Settings View Model Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Settings View Model Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Settings View Model Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Settings_View_Model_Save_Command_Unit_Tests
    displayName: 'Settings View Model Save Command Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Studio.Core.Tests -Category SettingsViewModel_SaveCommand>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Settings View Model Save Command Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Settings View Model Save Command Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Settings View Model Save Command Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Settings_View_Model_Is_Dirty_Unit_Tests
    displayName: 'Settings View Model Is Dirty Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Studio.Core.Tests -Category SettingsViewModel_IsDirty>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Settings View Model Is Dirty Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Settings View Model Is Dirty Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Settings View Model Is Dirty Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Log_Settings_View_Model_Constructor_Unit_Tests
    displayName: 'Log Settings View Model Constructor Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Studio.Core.Tests -Category LogSettingsViewModel_Constructor
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Log Settings View Model Constructor Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Log Settings View Model Constructor Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Log Settings View Model Constructor Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Settings_View_Model_On_Deactivate_Unit_Tests
    displayName: 'Settings View Model On Deactivate Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Studio.Core.Tests -Category SettingsViewModel_OnDeactivate
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Settings View Model On Deactivate Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Settings View Model On Deactivate Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Settings View Model On Deactivate Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Settings_View_Model_Returns_False_Unit_Tests
    displayName: 'Settings View Model Returns False Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Studio.Core.Tests -Category SettingsViewModel_ReturnsFalse
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Settings View Model Returns False Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Settings View Model Returns False Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Settings View Model Returns False Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Settings_View_Model_Do_Deactivate_Unit_Tests
    displayName: 'Settings View Model On Deactivate Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Studio.Core.Tests -Category SettingsViewModel_DoDeactivate
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Settings View Model Do Deactivate Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Settings View Model On Deactivate Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Settings View Model On Deactivate Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Log_Settings_View_Model_Server_Log_Level_Unit_Tests
    displayName: 'Log Settings View Model Server Log Level Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Studio.Core.Tests -Category LogSettingsViewModel_ServerLogLevel
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Log Settings View Model Server Log Level Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Log Settings View Model Server Log Level Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Log Settings View Model Server Log Level Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Log_Settings_View_Model_Update_Help_Unit_Tests
    displayName: 'Log Settings View Model Update Help Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Studio.Core.Tests -Category LogSettingsViewModel_UpdateHelp
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Log Settings View Model Update Help Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Log Settings View Model Update Help Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Log Settings View Model Update Help Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Log_Settings_View_Model_Selected_Logging_Type_Unit_Tests
    displayName: 'Log Settings View Model Selected Logging Type Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Studio.Core.Tests -Category LogSettingsViewModel_SelectedLoggingType
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Log Settings View Model Selected Logging Type Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Log Settings View Model Selected Logging Type Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Log Settings View Model Selected Logging Type Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Log_Settings_View_Model_Get_Log_File_Command_Unit_Tests
    displayName: 'Log Settings View Model Get Log File Command Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Studio.Core.Tests -Category LogSettingsViewModel_GetLogFileCommand
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Log Settings View Model Get Log File Command Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Log Settings View Model Get Log File Command Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Log Settings View Model Get Log File Command Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Log_Settings_View_Model_Property_Change_Fired_Unit_Tests
    displayName: 'Log Settings View Model Property Change Fired Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Studio.Core.Tests -Category LogSettingsViewModel_PropertyChangeFired
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Log Settings View Model Property Change Fired Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Log Settings View Model Property Change Fired Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Log Settings View Model Property Change Fired Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Log_Settings_View_Model_Studio_File_Log_Level_Unit_Tests
    displayName: 'Log Settings View Model Studio File Log Level Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Studio.Core.Tests -Category LogSettingsViewModel_StudioFileLogLevel
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Log Settings View Model Studio File Log Level Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Log Settings View Model Studio File Log Level Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Log Settings View Model Studio File Log Level Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Log_Settings_View_Model_Construct_Unit_Tests
    displayName: 'Log Settings View Model Construct Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Studio.Core.Tests -Category LogSettingsViewModel_Construct
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Log Settings View Model Construct Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Log Settings View Model Construct Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Log Settings View Model Construct Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Elasticsearch_View_Models_Unit_Tests
    displayName: 'Elasticsearch View Model Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Studio.ViewModels.Tests -Category ElasticsearchSourceViewModel
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Elasticsearch View Model Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Elasticsearch View Model Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Elasticsearch View Model Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Elasticsearch_Source_View_Model_Constructor_Unit_Tests
    displayName: 'Elasticsearch View Model Constructor Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Studio.ViewModels.Tests -Category ElasticsearchSourceViewModel_Constructor
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Elasticsearch View Model Constructor Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Elasticsearch View Model Constructor Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Elasticsearch View Model Constructor Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Elasticsearch_Source_View_Model_Test_Ok_Command_Unit_Tests
    displayName: 'Elasticsearch View Model Test Ok Command Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Studio.ViewModels.Tests -Category ElasticsearchSourceViewModel_TestOkCommand
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Elasticsearch View Model Test Ok Command Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Elasticsearch View Model Test Ok Command Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Elasticsearch View Model Test Ok Command Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Elasticsearch_Source_View_Model_Test_Name_Unit_Tests
    displayName: 'Elasticsearch View Model Test Name Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Studio.ViewModels.Tests -Category ElasticsearchSourceViewModel_TestName
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Elasticsearch View Model Test Name Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Elasticsearch View Model Test Name Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Elasticsearch View Model Test Name Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Elasticsearch_Source_View_Model_Request_Service_Name_View_Model_Unit_Tests
    displayName: 'Elasticsearch View Model Request Service Name View Model Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Studio.ViewModels.Tests -Category ElasticsearchSourceViewModel_RequestServiceNameViewModel
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Elasticsearch View Model Request Service Name View Model Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Elasticsearch View Model Request Service Name View Model Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Elasticsearch View Model Request Service Name View Model Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Elasticsearch_Source_View_Model_Test_Resource_Name_Unit_Tests
    displayName: 'Elasticsearch View Model Test Resource Name Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Studio.ViewModels.Tests -Category ElasticsearchSourceViewModel_TestResourceName
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Elasticsearch View Model Test Resource Name Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Elasticsearch View Model Test Resource Name Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Elasticsearch View Model Test Resource Name Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Elasticsearch_Source_View_Model_Test_Host_Name_Unit_Tests
    displayName: 'Elasticsearch View Model Test Host Name Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Studio.ViewModels.Tests -Category ElasticsearchSourceViewModel_TestHostName
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Elasticsearch View Model Test Host Name Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Elasticsearch View Model Test Host Name Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Elasticsearch View Model Test Host Name Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Elasticsearch_Source_View_Model_Test_Port_Unit_Tests
    displayName: 'Elasticsearch View Model Test Port Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Studio.ViewModels.Tests -Category ElasticsearchSourceViewModel_TestPort
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Elasticsearch View Model Test Port Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Elasticsearch View Model Test Port Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Elasticsearch View Model Test Port Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Elasticsearch_Source_View_Model_Test_Username_Unit_Tests
    displayName: 'Elasticsearch View Model Test Username Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Studio.ViewModels.Tests -Category ElasticsearchSourceViewModel_TestUsername
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Elasticsearch View Model Test Username Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Elasticsearch View Model Test Username Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Elasticsearch View Model Test Username Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Elasticsearch_Source_View_Model_Test_Password_Unit_Tests
    displayName: 'Elasticsearch View Model Test Password Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Studio.ViewModels.Tests -Category ElasticsearchSourceViewModel_TestPassword
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Elasticsearch View Model Test Password Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Elasticsearch View Model Test Password Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Elasticsearch View Model Test Password Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Elasticsearch_Source_View_Model_Test_Authentication_Type_Unit_Tests
    displayName: 'Elasticsearch View Model Test Authentication Type Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Studio.ViewModels.Tests -Category ElasticsearchSourceViewModel_TestAuthenticationType
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Elasticsearch View Model Test Authentication Type Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Elasticsearch View Model Test Authentication Type Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Elasticsearch View Model Test Authentication Type Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Elasticsearch_Source_View_Model_Test_Unit_Tests
    displayName: 'Elasticsearch View Model Test Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Studio.ViewModels.Tests -Category ElasticsearchSourceViewModel_Test
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Elasticsearch View Model Test Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Elasticsearch View Model Test Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Elasticsearch View Model Test Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Elasticsearch_Source_View_Model_Test_Header_Text_Unit_Tests
    displayName: 'Elasticsearch View Model Test Header Text Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Studio.ViewModels.Tests -Category ElasticsearchSourceViewModel_TestHeaderText
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Elasticsearch View Model Test Header Text Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Elasticsearch View Model Test Header Text Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Elasticsearch View Model Test Header Text Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Elasticsearch_Source_View_Model_Test_Model_Item_Unit_Tests
    displayName: 'Elasticsearch View Model Test Model Item Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Studio.ViewModels.Tests -Category ElasticsearchSourceViewModel_TestModelItem
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Elasticsearch View Model Test Model Item Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Elasticsearch View Model Test Model Item Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Elasticsearch View Model Test Model Item Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Elasticsearch_Source_View_Model_Test_Save_Source_Unit_Tests
    displayName: 'Elasticsearch View Model Test Save Source Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Studio.ViewModels.Tests -Category ElasticsearchSourceViewModel_TestSaveSource
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Elasticsearch View Model Test Save Source Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Elasticsearch View Model Test Save Source Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Elasticsearch View Model Test Save Source Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Elasticsearch_Source_View_Model_Test_Save_Unit_Tests
    displayName: 'Elasticsearch View Model Test Save Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Studio.ViewModels.Tests -Category ElasticsearchSourceViewModel_TestSave
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Elasticsearch View Model Test Save Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Elasticsearch View Model Test Save Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Elasticsearch View Model Test Save Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Elasticsearch_Source_View_Model_Test_Update_Help_Descriptor_Unit_Tests
    displayName: 'Elasticsearch View Model Test Update Help Descriptor Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Studio.ViewModels.Tests -Category ElasticsearchSourceViewModel_TestUpdateHelpDescriptor
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Elasticsearch View Model Test Update Help Descriptor Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Elasticsearch View Model Test Update Help Descriptor Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Elasticsearch View Model Test Update Help Descriptor Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Elasticsearch_Source_View_Model_Test_Can_Save_Unit_Tests
    displayName: 'Elasticsearch View Model Test Can Save Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Studio.ViewModels.Tests -Category ElasticsearchSourceViewModel_TestCanSave
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Elasticsearch View Model Test Can Save Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Elasticsearch View Model Test Can Save Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Elasticsearch View Model Test Can Save Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Elasticsearch_Source_View_Model_Can_Test_Unit_Tests
    displayName: 'Elasticsearch View Model Can Test Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Studio.ViewModels.Tests -Category ElasticsearchSourceViewModel_CanTest
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Elasticsearch View Model Can Test Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Elasticsearch View Model Can Test Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Elasticsearch View Model Can Test Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Search_Specs
    displayName: 'Search Specs'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Activities.Specs -Category WarewolfSearch -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Search Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Search Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Search Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Logger_Unit_Tests
    displayName: 'Logger Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Logger.Tests>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Logger Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Logger Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Logger Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Rename_Tool_Specs_From_UNC
    displayName: 'Rename Tool Specs From UNC'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - powershell: |
        Set-Location "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        &"$(Agent.BuildDirectory)\s\bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Warewolf.Tools.Specs -Category FileRenameFromUNC
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Rename Tool Specs From UNC'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Rename Tool Specs From UNC Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
    
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults'
    
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Rename Tool Specs From UNC Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Not_Parallelizable_Unit_Tests
    displayName: 'Not Parallelizable Unit Tests'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.*.Tests,Warewolf.*.Tests,Warewolf.UIBindingTests.* -ExcludeProjects Dev2.Integration.Tests,Dev2.Studio.Core.Tests,Dev2.RunTime.Tests,Dev2.Infrastructure.Tests,Warewolf.UI.Tests,Warewolf.Logger.Tests,Warewolf.Studio.ViewModels.Tests,Warewolf.Web.UI.Tests,Warewolf.Storage.Tests,Warewolf.Auditing.Tests,Warewolf.UIBindingTests.Deploy,Warewolf.UIBindingTests.ComPluginSource -Category CannotParallelize
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)/s/Bin/BuildUnderTest/TestResults/*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Not Parallelizable Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Not Parallelizable Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Not Parallelizable Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Gather_System_Information_Unit_Tests
    displayName: 'Gather System Information Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.*.Tests,Warewolf.*.Tests,Warewolf.UIBindingTests.* -ExcludeProjects Dev2.Integration.Tests,Dev2.Studio.Core.Tests,Dev2.RunTime.Tests,Dev2.Infrastructure.Tests,Warewolf.UI.Tests,Warewolf.Logger.Tests,Warewolf.Studio.ViewModels.Tests,Warewolf.Web.UI.Tests,Warewolf.Storage.Tests,Warewolf.Auditing.Tests,Warewolf.UIBindingTests.Deploy,Warewolf.UIBindingTests.ComPluginSource -Category GatherSystemInformation>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Gather System Information Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Gather System Information Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Gather System Information Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Database_Workflow_Execution_Specs
    displayName: 'Database Workflow Execution Specs'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Activities.Specs -Category DatabaseWorkflowExecution -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Database Workflow Execution Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Database Workflow Execution Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Database Workflow Execution Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: RabbitMQ_Workflow_Execution_Specs
    displayName: 'RabbitMQ Workflow Execution Specs'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Activities.Specs -Category RabbitMQWorkflowExecution -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'RabbitMQ Workflow Execution Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'RabbitMQ Workflow Execution Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'RabbitMQ Workflow Execution Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Studio_Test_Framework_With_HTTP_Web_Get_Tools_Specs
    displayName: 'Studio Test Framework With HTTP Web Get Tools Specs'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Activities.Specs -Category StudioTestFrameworkWithHTTPWebGetTools -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Test Framework With HTTP Web Get Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Studio Test Framework With HTTP Web Get Tools Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Studio Test Framework With HTTP Web Get Tools Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Studio_Test_Framework_With_HTTP_Web_Delete_Tools_Specs
    displayName: 'Studio Test Framework With HTTP Web Delete Tools Specs'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Activities.Specs -Category StudioTestFrameworkWithHTTPWebDeleteTools -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Test Framework With HTTP Web Delete Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Studio Test Framework With HTTP Web Delete Tools Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Studio Test Framework With HTTP Web Delete Tools Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Studio_Test_Framework_With_HTTP_Web_Post_Tools_Specs
    displayName: 'Studio Test Framework With HTTP Web Post Tools Specs'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Activities.Specs -Category StudioTestFrameworkWithHTTPWebPostTools -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Test Framework With HTTP Web Post Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Studio Test Framework With HTTP Web Post Tools Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Studio Test Framework With HTTP Web Post Tools Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Studio_Test_Framework_With_HTTP_Web_Put_Tools_Specs
    displayName: 'Studio Test Framework With HTTP Web Put Tools Specs'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Activities.Specs -Category StudioTestFrameworkWithHTTPWebPutTools -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Test Framework With HTTP Web Put Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Studio Test Framework With HTTP Web Put Tools Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Studio Test Framework With HTTP Web Put Tools Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Studio_Test_Framework_With_RabbitMQ_Tools_Specs
    displayName: 'Studio Test Framework With RabbitMQ Tools Specs'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Activities.Specs -Category StudioTestFrameworkWithRabbitMQTools -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Studio Test Framework With RabbitMQ Tools Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Studio Test Framework With RabbitMQ Tools Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Studio Test Framework With RabbitMQ Tools Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Database_Subworkflow_Execution_Specs
    displayName: 'Database Subworkflow Execution Specs'
  
    steps:
    - checkout: none
  
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Activities.Specs -Category DatabaseSubworkflowExecution -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Database Subworkflow Execution Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Database Subworkflow Execution Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Database Subworkflow Execution Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Intellisense_Textbox_Visual_Tree_Unit_Tests
    displayName: 'Intellisense Textbox Visual Tree Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\Bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Studio.Core.Tests -Category "Intellisense Textbox Visual Tree"
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)/s/Bin/BuildUnderTest/TestResults/*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Intellisense Textbox Visual Tree Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Intellisense Textbox Visual Tree Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Intellisense Textbox Visual Tree Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
  - job: Workflow_Execution_Logging_Specs
    displayName: 'Workflow Execution Logging Specs'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: none
    
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        docker rm -f $(Build.SourceVersion)
        docker create --name=$(Build.SourceVersion) registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion)
        del /f /s /q  "$(Agent.BuildDirectory)\s\bin" 1>nul
        rmdir /s /q "$(Agent.BuildDirectory)\s\bin"
        mkdir "$(Agent.BuildDirectory)\s\bin"
        docker cp $(Build.SourceVersion):C:\BuildUnderTest "$(Agent.BuildDirectory)\s\bin"
      displayName: 'Unpack Binaries'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - script: |
        cd /d "$(Agent.BuildDirectory)\s\bin\BuildUnderTest"
        powershell -NoProfile -NoLogo -ExecutionPolicy Bypass -NoExit -File "$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Activities.Specs -Category WorkflowExecutionLogging -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1
      displayName: 'Run Tests'
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)/s/Bin/BuildUnderTest/TestResults/*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Workflow Execution Logging Specs'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\*.trx" "$(Agent.BuildDirectory)\s\bin\BuildUnderTest\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults\Merged.coveragexml'
        ArtifactName: 'Workflow Execution Logging Specs Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\s\Bin\BuildUnderTest\TestResults\TestResults.trx'
        ArtifactName: 'Workflow Execution Logging Specs Results'
        publishLocation: 'Container'
        StoreAsTar: false
        
    - powershell: 'sc.exe stop "Warewolf Server";exit 0'
      condition: always()
      failOnStderr: false
  
  - job: Server_Startup_Tests
    displayName: 'Server Startup Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Integration.Tests -Category "Server Startup" -PreTestRunScript "StartAsService.ps1 -Cleanup -ResourcesPath ServerTests" -PostTestRunScript ReverseDeployLog.ps1>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Server Startup Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Server Startup Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Server Startup Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
  - job: Plugin_Handler_Unit_Tests
    displayName: 'Plugin Handler Unit Tests'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - script: |
        docker login --username ashley.lewis@theunlimited.co.za --password %GetVSTestContainer% registry.gitlab.com/warewolf/vstest
        mkdir "$(Agent.BuildDirectory)\TestResults"
        echo Set-Location C:\BuildUnderTest>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        echo ^&".\Job Shortcuts\TestRun.ps1" -Coverage -RetryCount 6 -Projects Dev2.Runtime.Tests -Category PluginRuntimeHandler>>"$(Agent.BuildDirectory)\TestResults\RunTestsEntrypoint.ps1"
        docker run -i --rm --memory 4g -v "$(Agent.BuildDirectory)\TestResults:C:\BuildUnderTest\TestResults" registry.gitlab.com/warewolf/vstest:$(Build.SourceVersion) powershell -File C:\BuildUnderTest\TestResults\RunTestsEntrypoint.ps1
      displayName: 'Run Tests'
      env:
        GetVSTestContainer: $(VSTestContainerPassword)
  
    - task: PublishTestResults@2
      inputs:
        testRunner: VSTest
        testResultsFiles: '$(Agent.BuildDirectory)\TestResults\*.trx'
        failTaskOnFailedTests: true
        testRunTitle: 'Plugin Handler Unit Tests'
        
    - script: 'if not exist "$(Agent.BuildDirectory)\TestResults\*.trx" (exit 1) else (copy "$(Agent.BuildDirectory)\TestResults\*.trx" "$(Agent.BuildDirectory)\TestResults\TestResults.trx")'

    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\Merged.coveragexml'
        ArtifactName: 'Plugin Handler Unit Tests Coverage Snapshot'
        publishLocation: 'Container'
        StoreAsTar: false
  
    - task: PublishCodeCoverageResults@1
      inputs:
        codeCoverageTool: 'Cobertura'
        summaryFileLocation: '$(Agent.BuildDirectory)\TestResults\Cobertura.xml'
        reportDirectory: '$(Agent.BuildDirectory)\TestResults'
  
    - task: PublishBuildArtifacts@1
      inputs:
        PathtoPublish: '$(Agent.BuildDirectory)\TestResults\TestResults.trx'
        ArtifactName: 'Plugin Handler Unit Tests Results'
        publishLocation: 'Container'
        StoreAsTar: false

- stage: Publish_to_SonarQube
  displayName: 'Publish to SonarQube'
  jobs:
  
  - job: Publish_to_SonarQube
    displayName: 'Publish to SonarQube'
    pool:
      vmImage: 'windows-2019'
  
    steps:
    - checkout: self
      clean: true
      persistCredentials: true
      
    - script: |
        mkdir D:\Builds
        IF NOT EXIST "D:\Builds\SonarQube" git -C "D:\Builds" clone "$(Build.Repository.Uri)" SonarQube
        IF EXIST "D:\Builds\SonarQube\.git\index.lock" DEL /F "D:\Builds\SonarQube\.git\index.lock"
        git -C "D:\Builds\SonarQube" reset --hard HEAD
        git -C "D:\Builds\SonarQube" clean -xdf --exclude Dev/packages/
        git -C "D:\Builds\SonarQube" fetch --all
        IF [$(Build.SourceVersion)] NEQ [] (
            echo Checking out version $(Build.SourceVersion)
            git -C "D:\Builds\SonarQube" checkout $(Build.SourceVersion)
        ) ELSE (
            IF [$(Build.SourceBranch)] NEQ [] (
                echo Checking out branch $(Build.SourceBranch)
                git -C "D:\Builds\SonarQube" checkout $(Build.SourceBranch)
            )
            git -C "D:\Builds\SonarQube" pull
        )
      displayName: 'Scorch Sonar Shared Working Directory'
      
    - powershell: |
        $jdkPath = $env:JAVA_HOME_11_X64
        Write-Host "##vso[task.setvariable variable=JAVA_HOME]$jdkPath"
      displayName: "Use JDK11 by default"
      
    - task: DownloadPipelineArtifact@2
      
    - powershell: 'nuget restore "D:\Builds\SonarQube\Dev\AcceptanceTesting.sln"'
      displayName: "Restore Nuget Packages"
      
    - task: DownloadPipelineArtifact@2
      inputs:
        source: 'specific'
        project: '$(System.TeamProjectId)'
        pipeline: 10
        runVersion: 'latest'
        allowPartiallySucceededBuilds: true
        
    - powershell: |
        New-Item -ItemType Directory "D:\Builds\SonarQube\bin\AcceptanceTesting"
        expand "$(Agent.BuildDirectory)\WebView2\Microsoft.WebView2.FixedVersionRuntime.cab" -F:* "D:\Builds\SonarQube\bin\AcceptanceTesting"
      displayName: 'Expand WebView2 Cab'
    
    - powershell: |
        $branchSource = "$(Build.SourceBranch)"
        $ThisBranch = $branchSource -replace "refs/heads/", ""
        $SonarRunnerXML = @"
        <SonarQubeAnalysisProperties  xmlns:xsi=`"http://www.w3.org/2001/XMLSchema-instance`" xmlns:xsd=`"http://www.w3.org/2001/XMLSchema`" xmlns=`"http://www.sonarsource.com/msbuild/integration/2015/1`">
            <Property Name=`"sonar.host.url`">https://sonarcloud.io/</Property>
            <Property Name=`"sonar.lf.logoUrl`">https://warewolf.io/images/logo.png</Property>
            <Property Name=`"sonar.scm.provider`">git</Property>
            <Property Name=`"sonar.scm.url`">scm:git:https://gitlab.com/warewolf/warewolf</Property>
            <Property Name=`"sonar.organization`">warewolf</Property>
            <Property Name=`"sonar.verbose`">false</Property>
            <Property Name=`"sonar.exclusions`">**/*.xaml,**/*.xaml.cs,Dev2.Web2/Content/*.js,Dev2.Web2/Content/*.css,Dev2.Web2/Scripts/*.js</Property>
            <Property Name=`"sonar.branch.name`">$ThisBranch</Property>
        "@
        if ("$ThisBranch" -ne "develop") {
            $SonarRunnerXML += @"
            <Property Name=`"sonar.branch.target`">develop</Property>
        "@
        }
        $SonarRunnerXML += @"
            <Property Name=`"sonar.cs.vstest.reportsPaths`">$(Pipeline.Workspace)\TestResults*.trx</Property>
            <Property Name=`"sonar.cs.vscoveragexml.reportsPaths`">$(Pipeline.Workspace)\**\Merged.coveragexml</Property>
        </SonarQubeAnalysisProperties>
        "@
        
        Out-File -LiteralPath "$(Pipeline.Workspace)\SonarQube.Analysis.xml" -Encoding default -InputObject $SonarRunnerXML
        Write-Host Wrote Sonar Runner to "$(Pipeline.Workspace)\SonarQube.Analysis.xml" as $SonarRunnerXML.
      displayName: "Write Sonar Runner"
        
    - script: |
        IF "%bamboo_RerunBuildTriggerReason_noOfRetries%"=="" (set SonarVersion="$(Build.TriggeredBy.BuildId)") ELSE (set SonarVersion="$(Build.TriggeredBy.BuildId)-%RerunBuildTriggerReason_noOfRetries%")
        cd "D:\Builds\SonarQube"
        nuget install dotnet-framework-sonarscanner -ExcludeVersion -NonInteractive -OutputDirectory .
        ".\dotnet-framework-sonarscanner\tools\SonarScanner.MSBuild.exe" begin /o:warewolf /k:Warewolf_DotNet_Framework /n:Warewolf_DotNet_Framework /v:%SonarVersion% /d:sonar.login="%SonarPassword%" /s:"$(Pipeline.Workspace)\SonarQube.Analysis.xml" /d:sonar.projectBaseDir="D:\Builds\SonarQube"
      env:
        SonarPassword: $(SonarAdminPassword)
      displayName: "Begin Sonar Runner"
      
    - task: PowerShell@2
      inputs:
        filePath: 'D:\Builds\SonarQube\Compile.ps1'
        arguments: '-AcceptanceTesting -Config Release -Target Rebuild -ProjectSpecificOutputs -MSBuildPath "C:\Program Files (x86)\Microsoft Visual Studio\2019\Enterprise\MSBuild\Current\Bin\MSBuild.exe"'
      displayName: 'Compile in Release Config'
  
    - script: |
        cd "D:\Builds\SonarQube"
        ".\dotnet-framework-sonarscanner\tools\SonarScanner.MSBuild.exe" end /d:"sonar.login=%SonarPassword%"
      env:
        SonarPassword: $(SonarAdminPassword)
      displayName: "End Sonar Runner"