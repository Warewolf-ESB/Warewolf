schedules:
- cron: "0 0 * * *"
  displayName: Daily midnight build
  branches:
    include:
    - "*"

pool:
  name: Default

jobs:

- job: build
  displayName: 'Analyse'

  steps:
  - task: PowerShell@2
    inputs:
      filePath: '$(Agent.BuildDirectory)\s\Compile.ps1'
      arguments: '-AcceptanceTesting -MSBuildPath "C:\Program Files\Microsoft Visual Studio\2022\Enterprise\MSBuild\Current\Bin\MSBuild.exe"'
      
  - script: "'C:\Program Files\ApiPort\ApiPort.exe' analyze -f '$(Agent.BuildDirectory)\s\bin\AcceptanceTesting' -r HTML --force -t .NET"
      
  - task: PublishHtmlReport@1
    displayName: 'Publish HTML Report'
    inputs:
      reportDir: '$(Agent.BuildDirectory)\ApiPortAnalysis.html'