<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="IE=edge">
    <title>Register for Warewolf</title>
    <script src="https://js.chargebee.com/v2/chargebee.js"></script>
</head>
<body>
<h3>Checkout Drop-in</h3>
<button href="javascript:void(0)" onclick="openCheckout()">
    Subscribe
</button>
</body>
<script>
    let cbInstance, cart;
    window.addEventListener('DOMContentLoaded', function() {
        cbInstance = Chargebee.init({
            site: "warewolf-test"
        })
        cbInstance.setCheckoutCallbacks(function(cart) {
            // you can define a custom callbacks based on cart object
            return {
                loaded: function() {
                    console.log("checkout opened");
                },
                close: function() {
                    console.log("checkout closed");
                    var cart1 = cbInstance.getCart();
                    console.log(cart1);
                    window.external.idCheckout(cart1);
                },
                success: function(hostedPageId) {
                    console.log(hostedPageId);
                    window.external.idCheckout(hostedPageId);
                },
                step: function(value) {
                    // value -> which step in checkout
                    console.log(value);
                }
            }
        });
        // cbInstance.setCheckoutCallbacks(function(cart) {
        //     return {
        //         success: function(hpid, data) {
        //             console.log('success', hpid)
        //             //alert(hpid);
        //             // console.log('customer_id', data.subscription.customer_id)
        //             //alert( data.subscription.customer_id);
        //             alert( cart);
        //             //window.external.idCheckout(hpid);
        //             window.external.idCheckout(cart);
        //             return data;
        //         }
        //     }
        // })
        cart = cbInstance.getCart();

    })
    function openCheckout() {
        const planPriceId = 'developer'
        const planPriceQuantity = 1
        const product = cbInstance.initializeProduct(planPriceId, planPriceQuantity)
        cart.replaceProduct(product);
        // Dynamically changing Plan quantity using setPlanQuantity
        product.setPlanQuantity(planPriceQuantity);
        cart.proceedToCheckout();
    }
</script>
</html>